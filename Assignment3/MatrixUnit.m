function M = MatrixUnit(N,omega,omegaR,vR,gamma,a,c)

if N == 1
    S = ScatteringMatrix4(omega,omegaR,vR,gamma,a,c);
    
    M = zeros(4,4);
    M(1,1) = S(2,2); M(1,2) = S(2,1); M(1,3) = S(2,3); M(1,4) = S(2,4);
    M(2,1) = S(1,2); M(2,2) = S(1,1); M(2,3) = S(1,3); M(2,4) = S(1,4);
    M(3,1) = S(3,2); M(3,2) = S(3,1); M(3,3) = S(3,3); M(3,4) = S(3,4);
    M(4,1) = S(4,2); M(4,2) = S(4,1); M(4,3) = S(4,3); M(4,4) = S(4,4);
else    
    M = zeros(2*N+2,2*N+2);

    M1 = MatrixUnit(N-1, omega,omegaR,vR,gamma,a,c);
    S  = ScatteringMatrix4(omega,omegaR,vR,gamma,a,c);

    for i = 1:(2*N-1)
        for j = 1:(2*N-1)
            M(i,j)= M1(i,j)+M1(i,2*N)*M1(2*N,j)*S(2,2)/(1-S(2,2)*M1(2*N,2*N));
        end
        M(i,2*N)   = S(2,1)*M1(i,2*N)/(1-S(2,2)*M1(2*N,2*N));
        M(i,2*N+1) = S(2,3)*M1(i,2*N)/(1-S(2,2)*M1(2*N,2*N));
        M(i,2*N+2) = S(2,4)*M1(i,2*N)/(1-S(2,2)*M1(2*N,2*N));
    end
    
    for j = 1:(2*N-1)
            M(2*N,j)   = S(1,2)*M1(2*N,j)/(1-S(2,2)*M1(2*N,2*N));
            M(2*N+1,j) = S(3,2)*M1(2*N,j)/(1-S(2,2)*M1(2*N,2*N));
            M(2*N+2,j) = S(4,2)*M1(2*N,j)/(1-S(2,2)*M1(2*N,2*N));
    end

    M(2*N,2*N)     = S(1,1)+S(1,2)*S(2,1)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N,2*N+1)   = S(1,3)+S(1,2)*S(2,3)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N,2*N+2)   = S(1,4)+S(1,2)*S(2,4)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N+1,2*N)   = S(3,1)+S(3,2)*S(2,1)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N+1,2*N+1) = S(3,3)+S(3,2)*S(2,3)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N+1,2*N+2) = S(3,4)+S(3,2)*S(2,4)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N+2,2*N)   = S(4,1)+S(4,2)*S(2,1)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N+2,2*N+1) = S(4,3)+S(4,2)*S(2,3)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
    M(2*N+2,2*N+2) = S(4,4)+S(4,2)*S(2,4)*M1(2*N,2*N)/(1-S(2,2)*M1(2*N,2*N));
end

end